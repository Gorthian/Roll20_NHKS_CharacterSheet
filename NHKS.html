<!--
	EDITED by 			Gorthian
	Version				0.1
	Letzte Ã„nderung		2022-03-04
	
	GitHub				https://github.com/Gorthian/Roll20_NHKS_CharacterSheet
	Wiki				https://github.com/Gorthian/Roll20_NHKS_CharacterSheet/wiki
	Bugs & Issues		https://github.com/Gorthian/Roll20_NHKS_CharacterSheet/issues
//-->

<!-- Sheet //-->
<input type="hidden" class="sheet-tabstoggle" name="attr_sheetTab"  value="actor"  />
<div class="sheet-wrapper sheet-NHKS">
	<div class="sheet-menu">
		<button type="action" name="act_actor"><span data-i18n="actor"></span></button>
    	<button type="action" name="act_role"><span data-i18n="role"></span></button>
	</div>
	<div class="sheet-content">
		<div class="sheet-actor">
			<div class="sheet-actor-sheet">
				<div class="sheet-actor-attributes">
					<h1><span data-i18n="attributes-and-descriptions"></span></h1>
					<div class="sheet-actor-attributes-content">
						<div class="sheet-actor-attributes-left">
							<span class="sheet-input-line"><span class="sheet-label" data-i18n="name"></span><input type="text" name="attr_character_name" /></span>
							<span class="sheet-input-line"><span class="sheet-label" data-i18n="gender"></span><input type="text" name="attr_actor_gender" /></span>
							<span class="sheet-input-line"><span class="sheet-label" data-i18n="age"></span><input type="text" name="attr_actor_age" /></span>
							<span class="sheet-input-line"><span class="sheet-label" data-i18n="weight"></span><input type="text" name="attr_actor_weight" /></span>
							<span class="sheet-input-line"><span class="sheet-label" data-i18n="size"></span><input type="text" name="attr_actor_weight" /></span>
							<span class="sheet-input-line"><span class="sheet-label" data-i18n="nationality"></span><input type="text" name="attr_actor_nationality" /></span>
							<p><span class="sheet-label" data-i18n="stature"></span><textarea name="attr_actor_stature" value=""></textarea></p>
							<p><span class="sheet-label" data-i18n="description"></span><textarea name="attr_actor_description" value=""></textarea></p>
							<div class="sheet-actor-attributes-values">
								<div class="sheet-actor-attr-kno sheet-input-line">
									<span class="sheet-label">
										<span class="sheet-attr-short" data-i18n="knowledge-short"></span><br/>
										<span class="sheet-attr-full" data-i18n="knowledge"></span>
									</span>
									<input class="sheet-attribute-value" type="number" name="attr_knowledge" />
								</div>
								<div class="sheet-actor-attr-str sheet-input-line">
									<span class="sheet-label">
										<span class="sheet-attr-short" data-i18n="strength-short"></span><br/>
										<span class="sheet-attr-full" data-i18n="strength"></span>
									</span>
									<input class="sheet-attribute-value" type="number" name="attr_strength" />
								</div>
								<div class="sheet-actor-attr-col sheet-input-line">
									<span class="sheet-label">
										<span class="sheet-attr-short" data-i18n="coolness-short"></span><br/>
										<span class="sheet-attr-full" data-i18n="coolness"></span>
									</span>
									<input class="sheet-attribute-value" type="number" name="attr_coolness" />
								</div>
								<div class="sheet-actor-attr-sta sheet-input-line">
									<span class="sheet-label">
										<span class="sheet-attr-short" data-i18n="stamina-short"></span><br/>
										<span class="sheet-attr-full" data-i18n="stamina"></span>
									</span>
									<input class="sheet-attribute-value" type="number" name="attr_stamina" />
								</div>
								<div class="sheet-actor-attr-chi sheet-input-line">
									<span class="sheet-label">
										<span class="sheet-attr-short" data-i18n="chi-short"></span><br/>
										<span class="sheet-attr-full" data-i18n="chi"></span>
									</span>
									<input class="sheet-attribute-value" type="number" name="attr_chi" />
								</div>
								<div class="sheet-actor-attr-dex sheet-input-line">
									<span class="sheet-label">
										<span class="sheet-attr-short" data-i18n="dexterity-short"></span><br/>
										<span class="sheet-attr-full" data-i18n="dexterity"></span>
									</span>
									<input class="sheet-attribute-value" type="number" name="attr_dexterity" />
								</div>
							</div>
						</div>
						<div class="sheet-actor-attributes-right">
							<div class="sheet-actor-attr-hitpoints sheet-input-line">
								<span class="sheet-attr-name" data-i18n="hitpoints"></span><br/>
								<span class="sheet-attr-desc" data-i18n="hitpoints-desc"></span><br/>								
								<input type="number" name="attr_hitpoints" />
							</div>
							<div class="sheet-actor-attr-chipoints sheet-input-line">
								<span class="sheet-attr-name" data-i18n="chipoints"></span><br/>
								<span class="sheet-attr-desc" data-i18n="chipoints-desc"></span><br/>							
								<input type="number" name="attr_chipoints" />
							</div>
							<div class="sheet-actor-attr-famepoints sheet-input-line">
								<span class="sheet-attr-name" data-i18n="famepoints"></span><br/>
								<span class="sheet-attr-desc" data-i18n="famepoints-desc"></span><br/>
								<input type="number" name="attr_famepoints" />
							</div>
							<div class="sheet-actor-attr-awardpoints sheet-input-line">
								<span class="sheet-attr-name" data-i18n="awardpoints"></span><br/>
								<span class="sheet-attr-desc" data-i18n="awardpoints-desc"></span><br/>						
								<input type="number" name="attr_awardpoints" />
							</div>
							<div class="sheet-actor-attr-initiative sheet-input-line">
								<span class="sheet-attr-name" data-i18n="initiative"></span><br/>
								<span class="sheet-attr-desc" data-i18n="initiative-desc"></span><br/>						
								<input type="number" name="attr_initiative" />
							</div>
							<div class="sheet-actor-attr-melee-attack sheet-input-line">
								<span class="sheet-attr-name" data-i18n="melee-attack"></span><br/>
								<span class="sheet-attr-desc" data-i18n="melee-attack-desc"></span><br/>						
								<input type="number" name="attr_melee_attack" />
							</div>
							<div class="sheet-actor-attr-melee-defense sheet-input-line">
								<span class="sheet-attr-name" data-i18n="melee-defense"></span><br/>
								<span class="sheet-attr-desc" data-i18n="melee-defense-desc"></span><br/>							
								<input type="number" name="attr_melee_defense" />
							</div>							
							<div class="sheet-actor-attr-melee-damage sheet-input-line">
								<span class="sheet-attr-name" data-i18n="melee-damage"></span><br/>
								<span class="sheet-attr-desc" data-i18n="melee-damage-desc"></span><br/>						
								<input type="number" name="attr_melee_damage" />
							</div>
							<div class="sheet-actor-attr-ranged-attack sheet-input-line">
								<span class="sheet-attr-name" data-i18n="ranged-attack"></span><br/>
								<span class="sheet-attr-desc" data-i18n="ranged-attack-desc"></span><br/>							
								<input type="number" name="attr_ranged_attack" />
							</div>							
							<div class="sheet-actor-attr-ranged-damage sheet-input-line">
								<span class="sheet-attr-name" data-i18n="ranged-damage"></span><br/>
								<span class="sheet-attr-desc" data-i18n="ranged-damage-desc"></span><br/>							
								<input type="number" name="attr_ranged_damage" />
							</div>
						</div>						
					</div>
				</div>
				<div class="sheet-actor-skills">
					<h1><span data-i18n="skills"></span></h1>
				</div>
				<div class="sheet-actor-advantages">
					<h1><span data-i18n="advantages-and-disadvantages"></span></h1>
				</div>
				<div class="sheet-actor-movies">
					<h1><span data-i18n="movies"></span></h1>
				</div>
				<div class="sheet-actor-martialarts">
					<h1><span data-i18n="martialarts"></span></h1>
				</div>
				<div class="sheet-actor-awards">
					<h1><span data-i18n="awards"></span></h1>
				</div>
				<div class="sheet-actor-misc">
					<h1><span data-i18n="misc"></span></h1>
				</div>
			</div>			
		</div>
		<div class="sheet-role">
			<span>Rolle</span>
		</div>		
	</div>
	<div class="sheet-footer">
		Created by Gorthian | Supported by Hitdice | Copyright by ???
		<br/>More Infos: https://github.com/Gorthian/Roll20_NHKS_CharacterSheet
	</div>	
</div>


<!-- SheetWorker //-->
<script type="text/worker">
	
	/* Globale Variablen -- Start */
	/* Globale Variablen -- Ende */
	
	/* Tab-Wechsel */
	const buttonlist = ["actor","role"];
    buttonlist.forEach(button => {
        on(`clicked:${button}`, function() {
            setAttrs({
                sheetTab: button
            });
        });
    });
	
	/* Event-Listener -- Start */
	on("sheet:opened", function () {
		recalcValues();
	});
	
	on("change:stamina", function () {
		recalcHitpoints();
	});
	
	on("change:strength", function () {
		recalcMeleeAttack();
		recalcMeleeDefense();
	});
	
	on("change:dexterity", function () {
		recalcMeleeDefense();
		recalcRangedAttack();
	});
	
	on("change:chi", function () {
		recalcMeleeAttack();
		recalcChipoints();
		recalcMeleeDefense();
		recalcRangedAttack();
	});
	
	on("change:coolness", function () {
		recalcInitiative();
	});
	
	/* Event-Listener -- Ende */
	
		
	/* Funktionen -- Start */
	function recalcValues() {
		console.log("recalcValues");
		recalcHitpoints();
		recalcChipoints();
		recalcMeleeAttack();
		recalcMeleeDefense();
		recalcRangedAttack();
		recalcInitiative();
	}
	
	function recalcInitiative() {
		console.log("recalcInitiative");
		getAttrs(["coolness"], function (values){
			let iCoolness = parseInt(values["coolness"]||0);
			let iInitiative = iCoolness;
			let aAttributes = {};
			
			aAttributes["initiative"] = iInitiative;
			
			setAttrs(aAttributes);		
		});
	}
	
	function recalcHitpoints() {
		console.log("recalcHitpoints");
		getAttrs(["stamina"], function (values){
			let iStamina = parseInt(values["stamina"]||0);
			let iHitpoints = (iStamina + 4) * 10;
			let aAttributes = {};
			
			aAttributes["hitpoints"] = iHitpoints;
			
			setAttrs(aAttributes);		
		});
	}
	
	function recalcChipoints() {
		console.log("recalcChipoints");
		getAttrs(["chi"], function (values){
			let iChi = parseInt(values["chi"]||0);
			let iChipoints = iChi * 10;
			let aAttributes = {};
			
			aAttributes["chipoints"] = iChipoints;
			
			setAttrs(aAttributes);		
		});
	}
	
	function recalcMeleeAttack() {
		console.log("recalcMeleeAttack");
		getAttrs(["chi","strength"], function (values){
			let iChi = parseInt(values["chi"]||0);
			let iStrength = parseInt(values["strength"]||0);
			let iMeleeAttack = Math.round((iStrength * 2 + iChi) / 3);
			let aAttributes = {};
			
			aAttributes["melee_attack"] = iMeleeAttack;
			
			setAttrs(aAttributes);		
		});
	}
	
	function recalcMeleeDefense() {
		console.log("recalcMeleeDefense");
		getAttrs(["chi","strength","dexterity"], function (values){
			let iChi = parseInt(values["chi"]||0);
			let iStrength = parseInt(values["strength"]||0);
			let iDexterity = parseInt(values["dexterity"]||0);
			let iMeleeDefense = Math.round((iStrength + iDexterity + iChi) / 3);
			let aAttributes = {};
			
			aAttributes["melee_defense"] = iMeleeDefense;
			
			setAttrs(aAttributes);		
		});
	}
	
	function recalcRangedAttack() {
		console.log("recalcRangedAttack");
		getAttrs(["chi","dexterity"], function (values){
			let iChi = parseInt(values["chi"]||0);
			let iDexterity = parseInt(values["dexterity"]||0);
			let iRangedAttack = Math.round((iDexterity * 2 + iChi) / 3);
			let aAttributes = {};
			
			aAttributes["ranged_attack"] = iRangedAttack;
			
			setAttrs(aAttributes);		
		});
	}
	
	/* Funktionen -- Ende */
</script>